<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUMIGEN Game - Emma's Story</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            overflow: hidden;
        }

        /* Screen Management */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100dvh;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .screen.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Welcome Screen */
        #welcome-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            overflow-y: auto;
        }

        .welcome-content {
            text-align: center;
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }

        .rumigen-logo {
            max-width: 300px;
            width: 80%;
            height: auto;
            margin-bottom: 2rem;
        }

        .game-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1e3a8a;
        }

        .game-subtitle {
            color: #64748b;
            font-size: 1.2rem;
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .btn-primary {
            background: #185285;
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(24, 82, 133, 0.3);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(24, 82, 133, 0.4);
        }

        /* Character Selection Screen */
        #character-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            padding: 20px;
            overflow-y: auto;
        }

        .character-container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
        }

        .character-container h1 {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            color: #1e3a8a;
            margin-bottom: 1rem;
        }

        .character-logo {
            max-width: 300px;
            width: 60%;
            height: auto;
            margin: 0 auto 2rem auto;
            display: block;
        }

        .character-subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .character-selection-wrapper {
            position: relative;
            margin-top: 2rem;
        }

        .character-grid {
            display: flex;
            gap: 2rem;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 20px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .character-grid::-webkit-scrollbar {
            display: none;
        }

        .character-card {
            background: white;
            border-radius: 1rem;
            padding: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            flex: 0 0 calc(33.333% - 1.35rem);
            min-width: 280px;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .character-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .character-card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .character-card.disabled:hover {
            transform: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .character-image {
            width: 100%;
            aspect-ratio: 16/9;
            max-height: 280px;
            object-fit: contain;
            object-position: center;
            padding: 1.5rem;
            background: white;
        }

        .character-content {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .character-name {
            font-size: 1.75rem;
            font-weight: 800;
            color: #1e3a8a;
            margin-bottom: 0.25rem;
        }

        .character-role {
            color: #64748b;
            font-weight: 500;
            margin-bottom: 1rem;
            font-size: 1.05rem;
        }

        .character-bio {
            color: #475569;
            font-size: 0.95rem;
            line-height: 1.65;
            margin-bottom: 1.5rem;
            flex: 1;
        }

        .select-btn {
            display: block;
            width: 100%;
            background: #185285;
            color: white;
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .select-btn:hover {
            background: #1a5f96;
        }

        .character-card.disabled .select-btn {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .character-card.disabled .select-btn:hover {
            background: #cbd5e0;
        }

        /* Mobile Responsive for Character Cards */
        @media (max-width: 768px) {
            .character-container {
                padding: 20px;
            }

            .character-logo {
                max-width: 220px;
                margin-bottom: 1.5rem;
            }

            .character-container h1 {
                font-size: 1.75rem;
                margin-bottom: 0.5rem;
            }

            .character-subtitle {
                font-size: 0.95rem;
                margin-bottom: 1rem;
            }

            .character-grid {
                gap: 1rem;
                padding: 10px 0;
            }

            .character-card {
                min-width: 260px;
                flex: 0 0 85vw;
                max-height: 70dvh;
            }

            .character-image {
                max-height: 180px;
                padding: 1rem;
            }

            .character-content {
                padding: 1rem;
                overflow-y: auto;
            }

            .character-name {
                font-size: 1.4rem;
            }

            .character-role {
                font-size: 0.9rem;
                margin-bottom: 0.75rem;
            }

            .character-bio {
                font-size: 0.85rem;
                line-height: 1.5;
                margin-bottom: 1rem;
            }

            .select-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }

            .nav-arrow {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .nav-arrow.left {
                left: -15px;
            }

            .nav-arrow.right {
                right: -15px;
            }
        }

        /* Navigation Arrows */
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: 2px solid #1e3a8a;
            color: #1e3a8a;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 10;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .nav-arrow:hover {
            background: #1e3a8a;
            color: white;
            transform: translateY(-50%) scale(1.1);
        }

        .nav-arrow.left {
            left: -25px;
        }

        .nav-arrow.right {
            right: -25px;
        }

        .nav-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .nav-arrow:disabled:hover {
            background: white;
            color: #1e3a8a;
            transform: translateY(-50%);
        }

        /* Game Screen Styles */
        #game-screen {
            background: #b8e6e3;
        }

        .parallax-container {
            position: relative;
            width: 100vw;
            height: 100dvh;
            overflow: hidden;
            transition: opacity 1.5s ease, transform 1.5s ease;
        }

        .parallax-container.fade-out {
            opacity: 0;
            transform: scale(1.05);
        }

        .parallax-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: auto;
            height: 100dvh;
            display: flex;
            white-space: nowrap;
        }

        .parallax-layer img,
        .parallax-layer object {
            height: 100dvh;
            width: auto;
            pointer-events: none;
            display: inline-block;
            flex-shrink: 0;
            vertical-align: bottom;
        }

        .layer-segment {
            height: 100dvh;
            width: auto;
            flex-shrink: 0;
            position: relative;
            display: inline-flex;
            align-items: flex-end;
        }

        .layer-segment object,
        .layer-segment img {
            width: auto;
            height: 100dvh;
            display: block;
        }

        /* Layer z-indices */
        .layer-6 { z-index: 1; display: none; }
        .layer-5 { z-index: 2; }
        .layer-4 { z-index: 3; }
        .layer-3 { z-index: 4; }
        .layer-7 { z-index: 5; }
        .layer-2 { z-index: 6; }
        .layer-1 { z-index: 7; }

        /* Animations */
        @keyframes scrollRight {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-50%); }
        }

        @keyframes boerenkraamZoom {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        .layer-1 { animation: scrollRight 40s linear infinite; }
        .layer-2 { animation: scrollRight 50s linear infinite; }
        .layer-7 { animation: scrollRight 55s linear infinite; }
        .layer-3 { animation: scrollRight 50s linear infinite; }
        .layer-4 { animation: scrollRight 80s linear infinite; }
        .layer-5 { animation: scrollRight 100s linear infinite; }
        .layer-6 { animation: scrollRight 120s linear infinite; }

        /* Boerenkraam Scene */
        .boerenkraam-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100dvh;
            z-index: 200;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 1.5s ease, transform 1.5s ease;
            pointer-events: none;
            background: #b8e6e3;
            overflow: hidden;
        }

        .boerenkraam-container.active {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .boerenkraam-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100vw;
            height: auto;
            min-height: 100dvh;
            display: flex;
            align-items: flex-end;
            justify-content: flex-start;
        }

        .boerenkraam-layer object {
            width: 100%;
            height: auto;
            display: block;
            object-fit: contain;
            object-position: bottom center;
        }

        .boerenkraam-container .layer-6 { z-index: 1; display: none; animation: none; }
        .boerenkraam-container .layer-5 { z-index: 2; display: flex !important; width: auto !important; animation: scrollRight 40s linear infinite !important; }
        .boerenkraam-container .layer-4 { z-index: 3; animation: boerenkraamZoom 25s ease-in-out infinite; }
        .boerenkraam-container .layer-3 { z-index: 4; animation: boerenkraamZoom 25s ease-in-out infinite; }
        .boerenkraam-container .layer-7 { z-index: 5; animation: boerenkraamZoom 25s ease-in-out infinite; }
        .boerenkraam-container .layer-2 { z-index: 6; animation: boerenkraamZoom 20s ease-in-out infinite; }
        .boerenkraam-container .layer-1 { z-index: 7; animation: boerenkraamZoom 20s ease-in-out infinite; }

        .boerenkraam-container .layer-5 .layer-segment {
            width: auto !important;
            height: 100dvh;
            flex-shrink: 0;
            display: inline-flex;
            align-items: flex-end;
        }

        .boerenkraam-container .layer-5 .layer-segment object {
            width: auto !important;
            height: 100dvh;
            min-height: 100dvh;
            object-fit: cover !important;
            object-position: bottom center !important;
        }

        /* Questions Panel */
        .questions-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: auto;
            width: 50vw;
            height: 100dvh;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow-y: auto;
            z-index: 300;
            transition: opacity 0.8s ease;
        }

        .questions-panel.hidden {
            opacity: 0 !important;
            pointer-events: none;
        }

        .question-header {
            display: none;
        }

        .questions-logo {
            max-width: 15vw;
            width: auto;
            height: auto;
            margin-bottom: 20px;
            display: block;
        }

        .emma-intro {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .emma-intro strong {
            color: #185285;
        }

        .question-text {
            font-size: 22px;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-button {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px 25px;
            display: flex;
            align-items: flex-start;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option-button.clickable:hover {
            border-color: #185285;
            background: linear-gradient(135deg, rgba(24, 82, 133, 0.05), rgba(24, 82, 133, 0.08));
            transform: translateX(5px);
        }

        .option-button.locked {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f7fafc;
        }

        .option-label {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: #185285;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-right: 15px;
            font-size: 16px;
            flex-shrink: 0;
        }

        .option-button.locked .option-label {
            background: #cbd5e0;
        }

        .option-text {
            color: #2d3748;
            font-size: 16px;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option-title {
            font-size: 19px;
            font-weight: 700;
            color: #1e3a8a;
        }

        .option-description {
            font-size: 15px;
            color: #475569;
            line-height: 1.6;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .tradeoff-modal {
                position: relative;
                top: auto;
                bottom: auto;
                left: auto;
                right: auto;
                transform: none;
                width: 100%;
                max-width: 100%;
                height: auto;
                max-height: none;
                display: flex;
                align-items: flex-start;
                justify-content: flex-start;
                padding: 10px;
                overflow-y: auto;
                z-index: 100;
                box-sizing: border-box;
                flex: 1;
            }

            .tradeoff-modal.active {
                display: flex;
                flex-direction: column;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100dvh;
                padding: 0;
                gap: 0;
                box-sizing: border-box;
                overflow: hidden;
                z-index: 10000;
            }

            .tradeoff-content {
                padding: 20px;
                width: 100%;
                height: 100%;
                margin: 0;
                box-sizing: border-box;
                display: flex;
                flex-direction: column;
                justify-content: center;
                overflow: hidden;
            }

            .tradeoff-content > * {
                flex-shrink: 1;
                min-height: 0;
            }

            .tradeoff-title {
                font-size: clamp(12px, 3vw, 14px);
                margin-bottom: 5px;
            }

            .tradeoff-choice {
                font-size: clamp(11px, 2.5vw, 12px);
                margin-bottom: 4px;
            }

            .tradeoff-explanation {
                font-size: clamp(10px, 2.2vw, 11px);
                line-height: 1.35;
            }

            .questions-logo {
                max-width: 140px;
                margin-bottom: 15px;
            }

            .rumigen-logo {
                max-width: 220px;
            }

            .questions-panel {
                width: 100vw;
                height: 100dvh;
                padding: max(20px, env(safe-area-inset-top)) 20px max(30px, env(safe-area-inset-bottom)) 20px;
                justify-content: flex-start;
                opacity: 0;
                transition: opacity 2s ease;
            }

            .questions-panel.show {
                opacity: 1;
            }

            .question-header {
                font-size: 12px;
                margin-bottom: 12px;
            }

            .emma-intro {
                padding: 12px;
                margin-bottom: 15px;
                font-size: 13px;
            }

            .question-text {
                font-size: 20px;
                margin-bottom: 20px;
                line-height: 1.4;
            }

            .option-button {
                padding: 12px 15px;
                border-radius: 12px;
                gap: 10px;
            }

            .options-container {
                gap: 12px;
            }

            .option-label {
                width: 30px;
                height: 30px;
                line-height: 30px;
                font-size: 14px;
                margin-right: 12px;
            }

            .option-text {
                font-size: 14px;
                line-height: 1.5;
            }

            .option-title {
                font-size: 16px;
            }

            .option-description {
                font-size: 13px;
            }

            #character-screen .emma-character {
                display: block;
            }

            .tradeoff-modal.active ~ .restart-button {
                opacity: 1;
                pointer-events: auto;
                position: fixed;
                bottom: 10px;
                left: 10px;
                z-index: 10001;
            }
        }

        /* Landscape orientation on mobile */
        @media (max-height: 600px) and (orientation: landscape) {
            #welcome-screen {
                padding: 10px;
            }

            .welcome-content {
                padding: 15px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                min-height: 100dvh;
            }

            .rumigen-logo {
                max-width: 140px;
                margin-bottom: 0.5rem;
            }

            .game-title {
                font-size: 1.5rem;
                margin-bottom: 0.3rem;
            }

            .game-subtitle {
                font-size: 0.85rem;
                margin-bottom: 1rem;
            }

            .btn-primary {
                padding: 0.75rem 1.5rem;
                font-size: 0.95rem;
                width: auto;
                min-width: 180px;
            }

            #character-screen {
                padding: 10px;
                align-items: flex-start;
            }

            .character-container {
                padding: 5px;
                margin-top: 10px;
            }

            .character-logo {
                max-width: 100px;
                margin-bottom: 0.3rem;
            }

            .character-container h1 {
                font-size: 1.1rem;
                margin-bottom: 0.2rem;
            }

            .character-subtitle {
                font-size: 0.75rem;
                margin-bottom: 0.5rem;
            }

            .character-grid {
                gap: 0.75rem;
                padding: 5px 0;
            }

            .character-card {
                min-width: 180px;
                max-height: 280px;
            }

            .character-image {
                max-height: 80px;
                padding: 0.5rem;
            }

            .character-content {
                padding: 0.5rem;
            }

            .character-name {
                font-size: 1rem;
                margin-bottom: 0.1rem;
            }

            .character-role {
                font-size: 0.7rem;
                margin-bottom: 0.3rem;
            }

            .character-bio {
                font-size: 0.65rem;
                line-height: 1.3;
                margin-bottom: 0.5rem;
            }

            .select-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }
        }

        /* Emma Character */
        .emma-character {
            position: fixed;
            bottom: 0;
            right: 25%;
            transform: translateX(50%);
            width: min(800px, 50vw);
            max-height: 100dvh;
            height: auto;
            z-index: 250;
        }

        @media (max-width: 1200px) {
            .emma-character {
                width: min(600px, 45vw);
            }
        }

        @media (max-width: 768px) {
            .emma-character {
                right: 20%;
                width: 50vw;
                max-height: 60dvh;
                bottom: env(safe-area-inset-bottom, 0);
            }
        }

        @media (max-width: 480px) {
            .emma-character {
                width: 45vw;
                max-height: 55dvh;
            }
        }

        .emma-layers {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: flex-end;
        }

        .layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: auto;
        }

        .layer object {
            width: 100%;
            height: auto;
            max-height: 100dvh;
            object-fit: contain;
            object-position: bottom;
            pointer-events: none;
            display: block;
        }

        .layer-base { z-index: 2; }
        .layer-shirt { z-index: 5; }
        .layer-eyes {
            z-index: 3;
            opacity: 0;
        }
        .layer-eyes.active { opacity: 1; }
        
        .layer-mouth {
            z-index: 4;
            opacity: 0;
        }
        .layer-mouth.active { opacity: 1; }

        /* Controls */
        .audio-control {
            display: none;
        }

        .restart-button {
            position: relative;
            background: #185285;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(24, 82, 133, 0.4);
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
            flex-shrink: 0;
            width: fit-content;
            align-self: flex-start;
        }

        .boerenkraam-container.active ~ .left-column-wrapper .restart-button {
            opacity: 1;
            pointer-events: auto;
        }

        .restart-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(24, 82, 133, 0.5);
        }

        .pilot-badge {
            display: none;
        }

        /* Left column wrapper for modal and restart button */
        .left-column-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: max-content;
            max-width: 25vw;
            min-width: 280px;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 10px;
            padding: 50px;
            box-sizing: border-box;
            pointer-events: none;
            z-index: 10000;
        }

        .left-column-wrapper > * {
            pointer-events: auto;
        }

        /* Trade-off Banner */
        .tradeoff-modal {
            position: relative;
            width: 100%;
            height: fit-content;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            display: flex;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .tradeoff-modal {
                width: 100vw;
                padding: 0;
                justify-content: flex-start;
                overflow: hidden;
            }
            .left-column-wrapper {
                justify-content: space-between;
            }
        }

        /* Make modal wider on short screens */
        @media (max-height: 600px) {
            .left-column-wrapper {
                max-width: 35vw;
            }
            .tradeoff-content {
                padding: 15px;
            }
            .tradeoff-title {
                margin-bottom: 10px;
            }
            .tradeoff-choice {
                margin-bottom: 8px;
            }
        }

        @media (max-height: 500px) {
            .left-column-wrapper {
                max-width: 45vw;
                padding: 15px;
            }
            .tradeoff-content {
                padding: 12px;
            }
        }

        @media (max-height: 400px) {
            .left-column-wrapper {
                max-width: 55vw;
                padding: 12px;
            }
        }

        @media (max-height: 350px) {
            .left-column-wrapper {
                max-width: 65vw;
                padding: 10px;
            }
        }

        @media (max-height: 300px) {
            .left-column-wrapper {
                max-width: 75vw;
                padding: 10px;
            }
        }

        @media (max-height: 250px) {
            .left-column-wrapper {
                max-width: 90vw;
                padding: 8px;
            }
        }

        .tradeoff-modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .tradeoff-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: block;
            width: max-content;
            max-width: 100%;
            box-sizing: border-box;
            height: fit-content;
        }

        .tradeoff-explanation {
            width: 100%;
        }

        .tradeoff-title {
            font-size: 28px;
            color: #185285;
            margin-bottom: 12px;
            font-weight: bold;
        }

        .tradeoff-choice {
            font-size: 22px;
            color: #2d3748;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .tradeoff-explanation {
            font-size: 18px;
            color: #4a5568;
            line-height: 1.7;
            margin-bottom: 0;
        }

        .continue-button {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen active">
        <div class="welcome-content">
            <img src="assets/images/rumigen-logo.png" alt="RUMIGEN" class="rumigen-logo">
            <h1 class="game-title">RUMIGEN Scenario Game</h1>
            <p class="game-subtitle">An interactive exploration of food system values and trade-offs</p>
            <button class="btn-primary" onclick="showCharacterSelection()">Start Game</button>
        </div>
    </div>

    <!-- Character Selection Screen -->
    <div id="character-screen" class="screen">
        <div class="character-container">
            <img src="assets/images/rumigen-logo.png" alt="RUMIGEN" class="character-logo">
            <h1>Select Your Character</h1>
            <p class="character-subtitle">Choose who you want to experience the journey as</p>
            <div class="character-selection-wrapper">
                <button class="nav-arrow left" id="scroll-left" aria-label="Scroll left">‚Äπ</button>
                <div class="character-grid" id="character-grid">
                    <div class="character-card" onclick="selectEmma()">
                        <img src="assets/images/Character - Emma.jpg" alt="Emma" class="character-image" onerror="this.style.display='none'">
                        <div class="character-content">
                            <div class="character-name">Emma</div>
                            <div class="character-role">The active citizen</div>
                            <div class="character-bio">Emma, 28, lives in the city and works at an NGO with a focus on the environment. She enjoys cooking and browsing secondhand shops. Her friends come from all walks of life, and they often get into thoughtful (and fun) conversations about values, choices, and the world around them.</div>
                            <button class="select-btn">Select Emma ‚Üí</button>
                        </div>
                    </div>
                    <div class="character-card disabled">
                        <img src="assets/images/Character - Luca.jpg" alt="Luca" class="character-image" onerror="this.style.display='none'">
                        <div class="character-content">
                            <div class="character-name">Luca</div>
                            <div class="character-role">The young farmer</div>
                            <div class="character-bio">Luca, 32, is a young, motivated farmer who inherited his family's farm in rural Netherlands. He wants to modernize his farm, produce sustainably, and run a profitable business‚Äîbut these goals often compete. His journey makes him face tough decisions about what kind of farmer he wants to be.</div>
                            <button class="select-btn">Coming Soon</button>
                        </div>
                    </div>
                    <div class="character-card disabled">
                        <img src="assets/images/Character - Clara.jpg" alt="Clara" class="character-image" onerror="this.style.display='none'">
                        <div class="character-content">
                            <div class="character-name">Clara</div>
                            <div class="character-role">The food entrepreneur</div>
                            <div class="character-bio">Clara, 34, runs a small food production company producing artisan jams, chutneys, and sauces. She sources ingredients from local suppliers and sells at farmers markets and specialty stores. Clara constantly balances quality, sustainability, and staying competitive.</div>
                            <button class="select-btn">Coming Soon</button>
                        </div>
                    </div>
                    <div class="character-card disabled">
                        <img src="assets/images/Character - Ahmed.jpg" alt="Dr. Ahmed" class="character-image" onerror="this.style.display='none'">
                        <div class="character-content">
                            <div class="character-name">Dr. Ahmed</div>
                            <div class="character-role">The researcher</div>
                            <div class="character-bio">Dr. Ahmed, 42, is a food systems researcher at a university. His work focuses on sustainable agriculture, climate resilience, and circular food systems. Ahmed bridges science and practice, navigating academic demands while trying to create real-world impact.</div>
                            <button class="select-btn">Coming Soon</button>
                        </div>
                    </div>
                    <div class="character-card disabled">
                        <img src="assets/images/Character - Sofia.jpg" alt="Sofia" class="character-image" onerror="this.style.display='none'">
                        <div class="character-content">
                            <div class="character-name">Sofia</div>
                            <div class="character-role">The policy maker</div>
                            <div class="character-bio">Sofia, 38, works for the Ministry of Agriculture, Nature and Food Quality. She develops policies that shape the future of Dutch agriculture. Sofia balances environmental goals, economic viability, farmer concerns, and public opinion in every decision.</div>
                            <button class="select-btn">Coming Soon</button>
                        </div>
                    </div>
                </div>
                <button class="nav-arrow right" id="scroll-right" aria-label="Scroll right">‚Ä∫</button>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <!-- Supermarket Parallax -->
        <div class="parallax-container">
            <div class="parallax-layer layer-6">
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer6-06-Background---kleur.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer6-06-Background---kleur.svg" type="image/svg+xml"></object>
                </div>
            </div>
            <div class="parallax-layer layer-5">
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer5-05-Wolken.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer5-05-Wolken.svg" type="image/svg+xml"></object>
                </div>
            </div>
            <div class="parallax-layer layer-4">
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer4-04-ShopAchterlaag.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer4-04-ShopAchterlaag.svg" type="image/svg+xml"></object>
                </div>
            </div>
            <div class="parallax-layer layer-3">
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer3-03-Winkels.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer3-03-Winkels.svg" type="image/svg+xml"></object>
                </div>
            </div>
            <div class="parallax-layer layer-7">
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer7-Objects.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer7-Objects.svg" type="image/svg+xml"></object>
                </div>
            </div>
            <div class="parallax-layer layer-2">
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer2-02-Voor-Objecten.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer2-02-Voor-Objecten.svg" type="image/svg+xml"></object>
                </div>
            </div>
            <div class="parallax-layer layer-1">
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer1-01-planten.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer-segment">
                    <object data="SVG/Nieuw Supermarkt SVG/layer1-01-planten.svg" type="image/svg+xml"></object>
                </div>
            </div>
        </div>

        <!-- Boerenkraam Scene -->
        <div class="boerenkraam-container">
            <div class="boerenkraam-layer layer-6">
                <object data="SVG/Boerenkraam/layer6-06-Background---kleur.svg" type="image/svg+xml"></object>
            </div>
            <div class="boerenkraam-layer layer-5">
                <div class="layer-segment">
                    <object data="SVG/Boerenkraam/layer5-05-Wolken.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer-segment">
                    <object data="SVG/Boerenkraam/layer5-05-Wolken.svg" type="image/svg+xml"></object>
                </div>
            </div>
            <div class="boerenkraam-layer layer-4">
                <object data="SVG/Boerenkraam/layer4-04-ShopAchterlaag.svg" type="image/svg+xml"></object>
            </div>
            <div class="boerenkraam-layer layer-3">
                <object data="SVG/Boerenkraam/layer3-03-Winkels.svg" type="image/svg+xml"></object>
            </div>
            <div class="boerenkraam-layer layer-7">
                <object data="SVG/Boerenkraam/layer7-Objects.svg" type="image/svg+xml"></object>
            </div>
            <div class="boerenkraam-layer layer-2">
                <object data="SVG/Boerenkraam/layer2-02-Voor-Objecten.svg" type="image/svg+xml"></object>
            </div>
            <div class="boerenkraam-layer layer-1">
                <object data="SVG/Boerenkraam/layer1-01-planten.svg" type="image/svg+xml"></object>
            </div>
        </div>

        <div class="pilot-badge">üéØ PILOT DEMO</div>

        <!-- Left column wrapper for modal and restart button -->
        <div class="left-column-wrapper">
            <!-- Trade-off Modal -->
            <div class="tradeoff-modal" id="tradeoffModal">
                <div class="tradeoff-content">
                    <div class="tradeoff-title">Emma's Choice: The Farmers Market</div>
                    <div class="tradeoff-choice">Here's what I learned:</div>
                    <div class="tradeoff-explanation">I contributed directly to small-scale farmers and chose fresh, seasonal food with a lower environmental footprint. The downside? It took more time and planning‚Äîespecially since I needed a second stop to complete my grocery list.</div>
                    <button class="continue-button" onclick="closeTradeoff()">Continue Emma's Story ‚Üí</button>
                </div>
            </div>

            <button class="restart-button" id="restartBtn">Restart</button>
        </div>

        <button class="audio-control" id="audioBtn">Play Emma's Story</button>

        <!-- Emma Character -->
        <div class="emma-character">
            <div class="emma-layers">
                <!-- Base layer - hoofd zonder mond -->
                <div class="layer layer-base">
                    <object data="SVG/Emma Hoofd/layer12-Emma-Hoofd-Zonder-mond.svg" type="image/svg+xml"></object>
                </div>

                <!-- Ogen opties -->
                <div class="layer layer-eyes active" data-eyes="normal">
                    <object data="SVG/Emma Hoofd/layer11-Emma-Ogen-01---Normaal.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer layer-eyes" data-eyes="closed">
                    <object data="SVG/Emma Hoofd/layer9-Emma-Ogen-02---Dicht.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer layer-eyes" data-eyes="wide">
                    <object data="SVG/Emma Hoofd/layer10-Emma-Ogen-03---Wijd.svg" type="image/svg+xml"></object>
                </div>

                <!-- Mond opties -->
                <div class="layer layer-mouth" data-mouth="rest">
                    <object data="SVG/Emma Hoofd/layer3-Emma-Mond-03---Neutraal-Dicht.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer layer-mouth" data-mouth="AI">
                    <object data="SVG/Emma Hoofd/layer5-Emma-Mond-02---BreedOpen.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer layer-mouth" data-mouth="E">
                    <object data="SVG/Emma Hoofd/layer6-Emma-Mond-01---SmalOpen.svg" type="image/svg+xml"></object>
                </div>
                <div class="layer layer-mouth active" data-mouth="smile">
                    <object data="SVG/Emma Hoofd/layer2-Emma-Mond-05---Lach.svg" type="image/svg+xml"></object>
                </div>

                <!-- Shirt layer - voorop -->
                <div class="layer layer-shirt">
                    <object data="SVG/Emma Hoofd/layer1-Emma-Shirt.svg" type="image/svg+xml"></object>
                </div>
            </div>
        </div>

        <!-- Questions Panel -->
        <div class="questions-panel">
            <img src="assets/images/rumigen-logo.png" alt="RUMIGEN" class="questions-logo">
            <div class="question-header">üìç LOCATION: Shopping Area</div>
            <div class="emma-intro">
                <p><strong>Emma says:</strong> "Hey! I'm planning a dinner party tonight and I need your help deciding where to shop. I care about the environment, but I also need to be practical. What do you think I should do?"</p>
            </div>
            <div class="question-text">
                Where should Emma go to shop for her dinner party?
            </div>
            <div class="options-container">
                <div class="option-button clickable" data-option="A">
                    <span class="option-label">A</span>
                    <span class="option-text">
                        <span class="option-title">The farmers market</span>
                        <span class="option-description">It's the furthest away with mid-price produce. You would directly be supporting farmers from outside the city and get high-quality fresh produce, but you might need to stop by a second store after.</span>
                    </span>
                </div>
                <div class="option-button locked" data-option="B">
                    <span class="option-label">B</span>
                    <span class="option-text">
                        <span class="option-title">The chain supermarket store</span>
                        <span class="option-description">It's cheaper, closest to your apartment and is guaranteed to have all products and ingredients you need.</span>
                    </span>
                </div>
                <div class="option-button locked" data-option="C">
                    <span class="option-label">C</span>
                    <span class="option-text">
                        <span class="option-title">The specialty store</span>
                        <span class="option-description">It's a bit further away and more expensive, but has probably almost all products and ingredients you need, and you would be supporting a local sustainable focused business.</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Screen management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showCharacterSelection() {
            showScreen('character-screen');
        }

        function selectEmma() {
            showScreen('game-screen');
            // Start audio automatically after a short delay
            setTimeout(() => {
                document.getElementById('audioBtn').click();
            }, 500);
            
            // On mobile, show questions panel after Emma speaks for a while
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    document.querySelector('.questions-panel').classList.add('show');
                }, 10000); // Show after 10 seconds
            } else {
                // On desktop, show immediately
                document.querySelector('.questions-panel').classList.add('show');
            }
        }

        // Setup scroll arrows for character selection
        function setupScrollArrows() {
            const grid = document.getElementById('character-grid');
            const leftArrow = document.getElementById('scroll-left');
            const rightArrow = document.getElementById('scroll-right');

            if (!grid || !leftArrow || !rightArrow) return;

            leftArrow.addEventListener('click', () => {
                grid.scrollBy({ left: -400, behavior: 'smooth' });
            });

            rightArrow.addEventListener('click', () => {
                grid.scrollBy({ left: 400, behavior: 'smooth' });
            });

            function updateArrows() {
                leftArrow.disabled = grid.scrollLeft <= 0;
                rightArrow.disabled = grid.scrollLeft >= grid.scrollWidth - grid.clientWidth - 1;
            }

            grid.addEventListener('scroll', updateArrows);
            updateArrows();
        }

        // Initialize scroll arrows when character screen is shown
        document.addEventListener('DOMContentLoaded', () => {
            setupScrollArrows();
        });

        // Audio and Emma animation
        const mouthLayers = document.querySelectorAll('.layer-mouth');
        const eyeLayers = document.querySelectorAll('.layer-eyes');

        const voiceAudio = new Audio('Clipchamp/Effab - Emma - VO.mp3');
        const payoffAudio = new Audio('Clipchamp/Emmas Choice.mp3');
        const musicAudio = new Audio('Audio/297_full_cute-indy-girl_0140.mp3');
        musicAudio.volume = 0.07;
        musicAudio.loop = true;

        let audioContext = null;
        let analyser = null;
        let voiceSource = null;
        let audioInitialized = false;

        function initAudio() {
            if (audioInitialized) return;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 512;
            analyser.smoothingTimeConstant = 0.3;
            voiceSource = audioContext.createMediaElementSource(voiceAudio);
            voiceSource.connect(analyser);
            voiceSource.connect(audioContext.destination);
            audioInitialized = true;
        }

        const bufferLength = 256;
        const dataArray = new Uint8Array(bufferLength);

        let isPlaying = false;
        let animationFrame = null;
        let currentMouth = 'smile';
        let currentEyes = 'normal';
        let lastBlinkTime = 0;

        function switchMouth(mouthName) {
            if (currentMouth === mouthName) return;
            mouthLayers.forEach(layer => layer.classList.remove('active'));
            const selectedLayer = document.querySelector(`[data-mouth="${mouthName}"]`);
            if (selectedLayer) {
                selectedLayer.classList.add('active');
            }
            currentMouth = mouthName;
        }

        function switchEyes(eyesName) {
            if (currentEyes === eyesName) return;
            eyeLayers.forEach(layer => layer.classList.remove('active'));
            const selectedLayer = document.querySelector(`[data-eyes="${eyesName}"]`);
            if (selectedLayer) {
                selectedLayer.classList.add('active');
            }
            currentEyes = eyesName;
        }

        function handleBlinking(now) {
            const timeSinceLastBlink = now - lastBlinkTime;
            const nextBlinkTime = 4000 + Math.random() * 4000;
            
            if (timeSinceLastBlink > nextBlinkTime) {
                switchEyes('closed');
                setTimeout(() => {
                    if (isPlaying) {
                        switchEyes('normal');
                    }
                }, 150);
                lastBlinkTime = now;
            }
        }

        function analyzeAudio() {
            if (!analyser) return;
            
            analyser.getByteFrequencyData(dataArray);
            const now = performance.now();
            
            const midFreq = dataArray.slice(10, 40).reduce((a, b) => a + b) / 30;
            const voiceEnergy = midFreq / 255;
            
            if (voiceEnergy < 0.12) {
                switchMouth('rest');
            } else if (voiceEnergy < 0.28) {
                switchMouth('E');
            } else if (voiceEnergy < 0.50) {
                switchMouth('AI');
            } else {
                switchMouth('AI');
            }
            
            handleBlinking(now);
            
            if (isPlaying) {
                animationFrame = requestAnimationFrame(analyzeAudio);
            }
        }

        // Audio button
        document.getElementById('audioBtn').addEventListener('click', () => {
            if (!isPlaying) {
                if (!audioInitialized) {
                    initAudio();
                }
                audioContext.resume().then(() => {
                    voiceAudio.play();
                    musicAudio.play();
                    
                    isPlaying = true;
                    document.getElementById('audioBtn').textContent = '‚è∏Ô∏è Pause';
                    switchEyes('normal');
                    lastBlinkTime = performance.now();
                    analyzeAudio();
                });
            } else {
                voiceAudio.pause();
                musicAudio.pause();
                isPlaying = false;
                document.getElementById('audioBtn').textContent = 'Play Emma\'s Story';
                switchMouth('smile');
                switchEyes('normal');
                if (animationFrame) {
                    cancelAnimationFrame(animationFrame);
                }
            }
        });

        // Question interaction
        document.querySelectorAll('.option-button').forEach(button => {
            button.addEventListener('click', function() {
                if (this.classList.contains('clickable')) {
                    const option = this.dataset.option;
                    
                    if (option === 'A') {
                        // Stop Emma's voice-over
                        voiceAudio.pause();
                        voiceAudio.currentTime = 0;
                        
                        // Stop lip-sync animation
                        isPlaying = false;
                        switchMouth('smile');
                        switchEyes('normal');
                        if (animationFrame) {
                            cancelAnimationFrame(animationFrame);
                        }
                        
                        // Start payoff audio
                        if (!audioInitialized) {
                            initAudio();
                        }
                        
                        // Setup payoff audio with lip-sync
                        const payoffSource = audioContext.createMediaElementSource(payoffAudio);
                        payoffSource.connect(analyser);
                        payoffSource.connect(audioContext.destination);
                        
                        audioContext.resume().then(() => {
                            payoffAudio.play();
                            isPlaying = true;
                            lastBlinkTime = performance.now();
                            analyzeAudio();
                        });
                        
                        document.querySelector('.questions-panel').classList.add('hidden');
                        document.querySelector('.parallax-container').classList.add('fade-out');
                        setTimeout(() => {
                            document.querySelector('.boerenkraam-container').classList.add('active');
                        }, 200);
                        setTimeout(() => {
                            document.getElementById('tradeoffModal').classList.add('active');
                        }, 2000);
                    }
                }
            });
        });

        function closeTradeoff() {
            document.getElementById('tradeoffModal').classList.remove('active');
            alert('In the full version, Emma would continue with her next question! üéâ');
        }

        // Restart button
        document.getElementById('restartBtn').addEventListener('click', () => {
            location.reload();
        });

        voiceAudio.addEventListener('ended', () => {
            isPlaying = false;
            switchMouth('smile');
            switchEyes('normal');
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
        });

        payoffAudio.addEventListener('ended', () => {
            isPlaying = false;
            switchMouth('smile');
            switchEyes('normal');
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
        });

        switchMouth('smile');
        switchEyes('normal');
    </script>
</body>
</html>

